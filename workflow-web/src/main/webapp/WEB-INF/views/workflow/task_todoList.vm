

#define($cssblock)
<link href="#springUrl("")/static/css/plugins/jquery-qtip/jquery.qtip.min.css?$!application.getAttribute('/static/css/plugins/jquery-qtip/jquery.qtip.min.css')" rel="stylesheet">
<link href="#springUrl("")/static/css/plugins/jquery-ui/jquery-ui.min.css?$!application.getAttribute('/static/css/plugins/jquery-ui/jquery-ui.min.css')" rel="stylesheet">

<link href="#springUrl("")/static/css/plugins/webuploader/webuploader.css?$!application.getAttribute('/static/css/plugins/webuploader/webuploader.css')" rel="stylesheet">
<link href="#springUrl("")/static/css/demo/webuploader-demo.min.css?$!application.getAttribute('/static/css/demo/webuploader-demo.min.css')" rel="stylesheet">

#end

<div class="wrapper wrapper-content">
    <div class="row">
        <div class="col-sm-12">

            ## 采购单
            #foreach($dataForName in ${baseBuyOrderVOList})
                #if($!{velocityCount} == 2) #break #end
                <div class="row">
                    <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>$!{dataForName.processInstance.processDefinitionName}</h5>
                            </div>
                            <div class="ibox-content">
                                <table class="table table-bordered table-striped">
                                    <thead>
                                    <tr>
                                        <th>项目名称</th>
                                        <th>申请人</th>
                                        <th>当前节点</th>
                                        <th>任务创建时间</th>
                                        <th>流程版本状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        #foreach($!{data} in $!{baseBuyOrderVOList})
                                        <tr id="$!{data.baseBuyOrder.id}" tid="$!{data.task.id}" pkey="$!data.processInstance.ProcessDefinitionKey" pid="$!{data.processInstance.id}">
                                            <td>$!{data.baseBuyOrder.name}</td>
                                            <td>$!{data.baseBuyOrder.userName}</td>
                                            <td>
                                                <a class="trace" href='javascript:;' pid="$!{data.processInstance.id}" pdid="${data.processInstance.processDefinitionId}" title="点击查看流程图">$!{data.task.name}</a>
                                            </td>
                                        ##                                <td><a target="_blank" href='${ctx}/workflow/resource/process-instance?pid=${data.processInstance.id}&type=xml'>${data.task.name}</a></td>
                                            <td>$!date.format('yyyy-MM-dd HH:mm:ss ',${data.task.createTime})</td>
                                            <td>
                                            ##                                    ${pi.suspended ? "已挂起" : "正常" }；
                                                <b title='流程版本号'>V: $!{data.processDefinition.version}</b>
                                            </td>
                                            <td>
                                                #if(!${data.task.assignee})
                                                    <a href="javascript:;" class="btn btn-info btn-sm button_to_start btn_claim"><i class="fa fa-play "></i> 签收 </a>
                                                #end
                                                #if(${data.task.assignee})
                                                ##  此处用tkey记录当前节点的名称
                                                    #if($data.isModify == true) ## 流程发起人调整流程
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_handle_modify" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 处理申请</a>

                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_edit" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-pencil "></i> 调整申请</a>
                                                    #else
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_handle" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 办理</a>
                                                    #end
                                                #end

                                                <a href="javascript:;" class="btn btn-default btn-sm button_view"><i class="fa fa-search "></i> 查看 </a>
                                            </td>
                                        </tr>
                                        #end
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            #end

            ## 框架采购单
            #foreach($dataForName in ${baseBuyOrderFrameVOList})
                #if($!{velocityCount} == 2) #break #end
                <div class="row">
                    <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>$!{dataForName.processInstance.processDefinitionName}</h5>
                            </div>
                            <div class="ibox-content">
                                <table class="table table-bordered table-striped">
                                    <thead>
                                    <tr>
                                        <th>项目名称</th>
                                        <th>申请人</th>
                                        <th>当前节点</th>
                                        <th>任务创建时间</th>
                                        <th>流程版本状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        #foreach($!{data} in $!{baseBuyOrderFrameVOList})
                                        <tr id="$!{data.baseBuyOrderFrame.id}" tid="$!{data.task.id}" pkey="$!data.processInstance.ProcessDefinitionKey" pid="$!{data.processInstance.id}">
                                            <td>$!{data.baseBuyOrderFrame.name}</td>
                                            <td>$!{data.baseBuyOrderFrame.userName}</td>
                                            <td>
                                                <a class="trace" href='javascript:;' pid="$!{data.processInstance.id}" pdid="${data.processInstance.processDefinitionId}" title="点击查看流程图">$!{data.task.name}</a>
                                            </td>
                                        ##                                <td><a target="_blank" href='${ctx}/workflow/resource/process-instance?pid=${data.processInstance.id}&type=xml'>${data.task.name}</a></td>
                                            <td>$!date.format('yyyy-MM-dd HH:mm:ss ',${data.task.createTime})</td>
                                            <td>
                                            ##                                    ${pi.suspended ? "已挂起" : "正常" }；
                                                <b title='流程版本号'>V: $!{data.processDefinition.version}</b>
                                            </td>
                                            <td>
                                                #if(!${data.task.assignee})
                                                    <a href="javascript:;" class="btn btn-info btn-sm button_to_start btn_claim"><i class="fa fa-play "></i> 签收 </a>
                                                #end
                                                #if(${data.task.assignee})
                                                ##  此处用tkey记录当前节点的名称
                                                    #if($data.isModify == true) ## 流程发起人调整流程
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_handle_modify" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 处理申请</a>

                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_edit" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-pencil "></i> 调整申请</a>
                                                    #else
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_handle" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 办理</a>
                                                    #end
                                                #end

                                                <a href="javascript:;" class="btn btn-default btn-sm button_view"><i class="fa fa-search "></i> 查看 </a>
                                            </td>
                                        </tr>
                                        #end
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            #end

            ## 需求单
            #foreach($dataForName in ${baseExecuteOrderVOList})
                #if($!{velocityCount} == 2) #break #end
                <div class="row">
                    <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>$!{dataForName.processInstance.processDefinitionName}</h5>
                            </div>
                            <div class="ibox-content">
                                <table class="table table-bordered table-striped">
                                    <thead>
                                    <tr>
                                        <th>项目名称</th>
                                        <th>申请人</th>
                                        <th>当前节点</th>
                                        <th>任务创建时间</th>
                                        <th>流程版本状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        #foreach($!{data} in $!{baseExecuteOrderVOList})
                                        <tr id="$!{data.baseExecuteOrder.id}" tid="$!{data.task.id}" pkey="$!data.processInstance.ProcessDefinitionKey" pid="$!{data.processInstance.id}">
                                            <td>$!{data.baseExecuteOrder.name}</td>
                                            <td>$!{data.baseExecuteOrder.userName}</td>
                                            <td>
                                                <a class="trace" href='javascript:;' pid="$!{data.processInstance.id}" pdid="${data.processInstance.processDefinitionId}" title="点击查看流程图">$!{data.task.name}</a>
                                            </td>
                                        ##                                <td><a target="_blank" href='${ctx}/workflow/resource/process-instance?pid=${data.processInstance.id}&type=xml'>${data.task.name}</a></td>
                                            <td>$!date.format('yyyy-MM-dd HH:mm:ss ',${data.task.createTime})</td>
                                            <td>
                                            ##                                    ${pi.suspended ? "已挂起" : "正常" }；
                                                <b title='流程版本号'>V: $!{data.processDefinition.version}</b>
                                            </td>
                                            <td tid="$!{data.baseExecuteOrder.id}" tname="$!{data.baseExecuteOrder.orderNum}">
                                                #if(!${data.task.assignee})
                                                    <a href="javascript:;" class="btn btn-info btn-sm button_to_start btn_claim"><i class="fa fa-play "></i> 签收 </a>
                                                #end
                                                #if(${data.task.assignee})
                                                ##  此处用tkey记录当前节点的名称
                                                    #if($data.isModify == true) ## 流程发起人调整流程
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_handle_modify" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 处理申请</a>

                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_edit" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-pencil "></i> 调整申请</a>
                                                    #else
                                                        #if($!{data.task.taskDefinitionKey} == 'uploadContractImg')
                                                            #if($!{data.baseExecuteOrder.contractImgCount} == 0)
                                                                <a href="javascript:;" class="btn btn-info btn-sm button_contract_img "><i class="fa fa-upload "></i> 上传扫描版合同 </a>
                                                            #else
                                                                <a href="javascript:;" class="btn btn-default btn-sm button_view_contract_img "><i class="fa fa-search "></i> 已上传合同 </a>
                                                                <a href="javascript:;" class="btn btn-info btn-sm button_contract_img_continue "><i class="fa fa-upload "></i> 续传 </a>
                                                                <a href="javascript:;" class="btn btn-info btn-sm button_contract_img_reupload "><i class="fa fa-upload "></i> 重新上传 </a>
                                                            #end
                                                        #end
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_handle" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 办理</a>
                                                    #end
                                                #end

                                                <a href="javascript:;" class="btn btn-default btn-sm button_view"><i class="fa fa-search "></i> 查看 </a>
                                            </td>
                                        </tr>
                                        #end
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            #end

            ## 框架需求单
            #foreach($dataForName in ${baseExecuteOrderFrameVOList})
                #if($!{velocityCount} == 2) #break #end
                <div class="row">
                    <div class="col-sm-12">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>$!{dataForName.processInstance.processDefinitionName}</h5>
                            </div>
                            <div class="ibox-content">
                                <table class="table table-bordered table-striped">
                                    <thead>
                                    <tr>
                                        <th>项目名称</th>
                                        <th>申请人</th>
                                        <th>当前节点</th>
                                        <th>任务创建时间</th>
                                        <th>流程版本状态</th>
                                        <th>操作</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        #foreach($!{data} in $!{baseExecuteOrderFrameVOList})
                                        <tr id="$!{data.baseExecuteOrderFrame.id}" tid="$!{data.task.id}" pkey="$!data.processInstance.ProcessDefinitionKey" pid="$!{data.processInstance.id}">
                                            <td>$!{data.baseExecuteOrderFrame.name}</td>
                                            <td>$!{data.baseExecuteOrderFrame.userName}</td>
                                            <td>
                                                <a class="trace" href='javascript:;' pid="$!{data.processInstance.id}" pdid="${data.processInstance.processDefinitionId}" title="点击查看流程图">$!{data.task.name}</a>
                                            </td>
                                        ##                                <td><a target="_blank" href='${ctx}/workflow/resource/process-instance?pid=${data.processInstance.id}&type=xml'>${data.task.name}</a></td>
                                            <td>$!date.format('yyyy-MM-dd HH:mm:ss ',${data.task.createTime})</td>
                                            <td>
                                            ##                                    ${pi.suspended ? "已挂起" : "正常" }；
                                                <b title='流程版本号'>V: $!{data.processDefinition.version}</b>
                                            </td>
                                            <td>
                                                #if(!${data.task.assignee})
                                                    <a href="javascript:;" class="btn btn-info btn-sm button_to_start btn_claim"><i class="fa fa-play "></i> 签收 </a>
                                                #end
                                                #if(${data.task.assignee})
                                                ##  此处用tkey记录当前节点的名称
                                                    #if($data.isModify == true) ## 流程发起人调整流程
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_handle_modify" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 处理申请</a>

                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_edit" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-pencil "></i> 调整申请</a>
                                                    #else
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_handle" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 办理</a>
                                                    #end
                                                #end

                                                <a href="javascript:;" class="btn btn-default btn-sm button_view"><i class="fa fa-search "></i> 查看 </a>
                                            </td>
                                        </tr>
                                        #end
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>
            #end



            ## 排期执行单
                #foreach($dataForName in ${baseExecuteOrderExecuteVOList})
                    #if($!{velocityCount} == 2) #break #end
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="ibox float-e-margins">
                                <div class="ibox-title">
                                    <h5>$!{dataForName.processInstance.processDefinitionName}</h5>
                                </div>
                                <div class="ibox-content">
                                    <table class="table table-bordered table-striped">
                                        <thead>
                                        <tr>
                                            <th>项目名称</th>
                                            <th>申请人</th>
                                            <th>当前节点</th>
                                            <th>任务创建时间</th>
                                            <th>流程版本状态</th>
                                            <th>操作</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                            #foreach($!{data} in $!{baseExecuteOrderExecuteVOList})
                                            <tr id="$!{data.baseExecuteOrder.id}" tid="$!{data.task.id}" pkey="$!data.processInstance.ProcessDefinitionKey" pid="$!{data.processInstance.id}">
                                                <td>$!{data.baseExecuteOrder.name}</td>
                                                <td>$!{data.baseExecuteOrder.userName}</td>
                                                <td>
                                                    <a class="trace" href='javascript:;' pid="$!{data.processInstance.id}" pdid="${data.processInstance.processDefinitionId}" title="点击查看流程图">$!{data.task.name}</a>
                                                </td>
                                            ##                                <td><a target="_blank" href='${ctx}/workflow/resource/process-instance?pid=${data.processInstance.id}&type=xml'>${data.task.name}</a></td>
                                                <td>$!date.format('yyyy-MM-dd HH:mm:ss ',${data.task.createTime})</td>
                                                <td>
                                                ##                                    ${pi.suspended ? "已挂起" : "正常" }；
                                                    <b title='流程版本号'>V: $!{data.processDefinition.version}</b>
                                                </td>
                                                <td tid="$!{data.baseExecuteOrder.id}" tname="$!{data.baseExecuteOrder.orderNum}">
                                                    #if(!${data.task.assignee})
                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_claim"><i class="fa fa-play "></i> 签收 </a>
                                                    #end
                                                    #if(${data.task.assignee})
                                                        ##  此处用tkey记录当前节点的名称
                                                        #if($data.isModify == true) ## 流程发起人调整流程
                                                            <a href="javascript:;" class="btn btn-info btn-sm btn_handle_modify" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 处理申请</a>

                                                        #else
                                                            #if($!{data.task.taskDefinitionKey} == 'uploadExecuteOrderImg')
                                                                #if($!{data.baseExecuteOrder.executeOrderImgCount} == 0)
                                                                    <a href="javascript:;" class="btn btn-info btn-sm button_execute_order_img "><i class="fa fa-upload "></i> 上传扫描版排期单 </a>
                                                                #else
                                                                    <a href="javascript:;" class="btn btn-default btn-sm button_view_execute_img "><i class="fa fa-search "></i> 已上传排期单 </a>
                                                                    <a href="javascript:;" class="btn btn-info btn-sm button_execute_img_continue "><i class="fa fa-upload "></i> 续传 </a>
                                                                    <a href="javascript:;" class="btn btn-info btn-sm button_execute_img_reupload "><i class="fa fa-upload "></i> 重新上传 </a>
                                                                #end
                                                            #elseif($!{data.task.taskDefinitionKey} == 'confirmCost')
                                                                <a href="javascript:;" class="btn btn-default btn-sm button_view_confirm_cost"><i class="fa fa-search "></i> 成本确认单 </a>
                                                            #elseif($!{data.task.taskDefinitionKey} == 'reminderPayment')
                                                                <a href="javascript:;" class="btn btn-default btn-sm button_view_reminder_payment"><i class="fa fa-search "></i> 应收催款单 </a>
                                                            #end
                                                            <a href="javascript:;" class="btn btn-info btn-sm btn_handle" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-play "></i> 办理</a>
                                                        #end

                                                        <a href="javascript:;" class="btn btn-info btn-sm btn_edit" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}'><i class="fa fa-pencil "></i> 调整申请</a>
                                                    #end

                                                    <a href="javascript:;" class="btn btn-default btn-sm button_view"><i class="fa fa-search "></i> 查看 </a>
                                                </td>
                                            </tr>
                                            #end
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                #end

        </div>
    </div>
</div>


## 审批用窗口
<div class="ibox-content task-audit" style="display:none">
    <form class="form-horizontal m-t" id="commentForm" action="">
        <div class="form-group">
            <label class="col-sm-3 control-label">
                *驳回原因:
            </label>
            <div class="col-sm-8">
##                <input id="reason" name="reason" placeholder="驳回原因" type="text" class="form-control" rows="6">
                <textarea class="form-control"  id="reason" name="reason" placeholder="驳回原因"  rows="3"></textarea>
            </div>
        </div>

        <div class="form-group">
            <div class="col-sm-3 col-sm-offset-1">
                <button class="btn btn-primary agree-apply" type="button"><i class="fa fa-check"></i> 同意</button>
            </div>
            <div class="col-sm-3 col-sm-offset-1">
                <button class="btn btn-danger reject-apply" type="button"><i class="fa fa-remove"></i> 驳回</button>
            </div>
        </div>
    </form>
</div>




## 申请人调整申请用窗口
<div class="ibox-content task-modify" style="display:none">
</div>


<div class="ibox-content file-upload" style="display:none">
    <div class="page-container">
        <p>您可以尝试文件拖拽，使用QQ截屏工具，然后激活窗口后粘贴，或者点击添加图片按钮，来上传图片（仅允许gif,jpg,jpeg,bmp,png格式，单个文件最大1M，批量共计最大10M）</p>
        <div id="uploader" class="wu-example">
            <div class="queueList">
                <div id="dndArea" class="placeholder">
                    <div id="filePicker"></div>
                    <p>或将图片拖到这里，单次最多可选30张</p>
                </div>
            </div>
            <div class="statusBar" style="display:none;">
                <div class="progress">
                    <span class="text">0%</span>
                    <span class="percentage"></span>
                </div>
                <div class="info"></div>
                <div class="btns">
                    <div id="filePicker2"></div>
                    <div class="uploadBtn">开始上传</div>
                </div>
            </div>
        </div>
    </div>
</div>





#define($jsblock)
<script type="text/javascript">
    // 添加全局站点信息
    var BASE_URL = '/webuploader';
    ##    var BASE_URL = '#springUrl("")/static/js/plugins/webuploader/index.html';
</script>

<script type="text/javascript" src="#springUrl("")/static/js/plugins/jquery-ui/jquery-ui.min.js?$!application.getAttribute('/static/js/plugins/jquery-ui/jquery-ui.min.js')"></script>
<script type="text/javascript" src="#springUrl("")/static/js/modules/activiti/workflow.js?$!application.getAttribute('/static/js/modules/activiti/workflow.js')"></script>
<script type="text/javascript" src="#springUrl("")/static/js/plugins/jquery-qtip/jquery.qtip.min.js?$!application.getAttribute('/static/js/plugins/jquery-qtip/jquery.qtip.min.js')"></script>
<script type="text/javascript" src="#springUrl("")/static/js/plugins/jquery-outerhtml/jquery.outerhtml.js?$!application.getAttribute('/static/js/plugins/jquery-outerhtml/jquery.outerhtml.js')"></script>
<script type="text/javascript" src="#springUrl("")/static/js/plugins/layer/laydate/laydate.js?$!application.getAttribute('/static/js/plugins/layer/laydate/laydate.js')" ></script>


<script type="text/javascript" src="#springUrl("")/static/js/plugins/webuploader/webuploader.min.js?$!application.getAttribute('/static/js/plugins/webuploader/webuploader.min.js')" ></script>
##<script type="text/javascript" src="#springUrl("")/static/js/demo/webuploader-demo.min.js?$!application.getAttribute('/static/js/demo/webuploader-demo.min.js')" ></script>
##<script type="text/javascript" src="#springUrl("")/static/js/demo/webuploader/webuploader.js?$!application.getAttribute('/static/js/demo/webuploader/webuploader.js')" ></script>
<script type="text/javascript" src="#springUrl("")/static/js/demo/webuploader/weiqz-demo.js?$!application.getAttribute('/static/js/demo/webuploader/weiqz-demo.js')" ></script>

<script>
    var taskId;
    var pkey;
    var tkey;
    var pid;
    var bizId;
    $(function(){
//        init();
    });


    // 跟踪
    $('.trace').click(graphTrace);

    ## 签收（示例：弹出确认框）
    $(".btn_claim").click(function(){
        var taskId = $(this).parents('tr').attr('tid');

        layer.confirm('确认签收？', {
            title: '确认',
            btn: ['确认','取消'] //按钮
        }, function(){
            window.location.href = "/workflow/task/claim/" + taskId;
        }, function(){
        });
    })

    ## 打开[办理]页面
    $(".btn_handle").click(function(){
        taskId = $(this).parents('tr').attr('tid');
        pkey = $(this).parents('tr').attr('pkey');
        pid = $(this).parents('tr').attr('pid');
        bizId = $(this).parents('tr').attr('id');
        tkey = $(this).attr('tkey');
//        var url = '/workflow/task/toAudit?pkey=' + pkey + '&tkey='+tkey + '&taskId='+taskId;
        if (tkey == 'signContract') {
            layer.confirm('是否已经联系客户签署合同', {
                title: '合同签署',
                btn: ['确认','取消'] //按钮
            }, function(){
                complete(true);
            }, function(){
            });
        } else if (tkey == 'uploadContractImg') {
            layer.confirm('是否已经上传<label class="text-danger">全部</label>扫描版合同', {
                title: '上传扫描合同',
                btn: ['确认','取消'] //按钮
            }, function(){
                complete(true);
            }, function(){
            });
        } else if (tkey == 'originalContract') {
            layer.confirm('是否已经向客户追要原章合同', {
                title: '追要原章合同',
                btn: ['确认','取消'] //按钮
            }, function(){
                complete(true);
            }, function(){
            });
        } else if (tkey == 'uploadExecuteOrderImg') {
            layer.confirm('是否已经上传<label class="text-danger">全部</label>扫描版排期单', {
                title: '上传扫描版排期单',
                btn: ['确认','取消'] //按钮
            }, function(){
                complete(true);
            }, function(){
            });
        } else if (tkey == 'originalExecuteOrder') {
            layer.confirm('是否已经追要原章排期单', {
                title: '追要原章排期单',
                btn: ['确认','取消'] //按钮
            }, function(){
                complete(true);
            }, function(){
            });
        } else if (tkey == 'confirmCost') {
            layer.confirm('是否已经确认收入成本确认单', {
                title: '收入成本确认',
                btn: ['确认','取消'] //按钮
            }, function(){
                complete(true);
            }, function(){
            });
        } else if (tkey == 'reminderPayment') {
            layer.confirm('是否已经向发出催款提醒', {
                title: '催款提醒',
                btn: ['确认','取消'] //按钮
            }, function(){
                complete(true);
            }, function(){
            });
        } else if (tkey == 'gathering') {
            layer.confirm('是否已经向客户发出催款要求', {
            title: '向客户催款',
                    btn: ['确认','取消'] //按钮
            }, function(){
                complete(true);
            }, function(){
            });

        } else {
            openPopDivPage_taskAudit();
        }
    })

    ## 打开[申请人调整申请用窗口]页面
    $(".btn_handle_modify").click(function(){
        taskId = $(this).parents('tr').attr('tid');
        pkey = $(this).parents('tr').attr('pkey');
        pid = $(this).parents('tr').attr('pid');
        bizId = $(this).parents('tr').attr('id');
        tkey = $(this).attr('tkey');
//        var url = '/workflow/task/toAudit?pkey=' + pkey + '&tkey='+tkey + '&taskId='+taskId;
        openPopDivPage_taskModify();
    })

    ## 查看
    $(".button_view").click(function(){
        var bizId = $(this).parents('tr').attr('id'); // 取申请ID
        var pkey = $(this).parents('tr').attr('pkey');
        if (pkey == "saleExecute") {
            pkey ="saleOrder";
        }
        var url = "${rc.contextPath}/"+ pkey+"/refer?id="+bizId;
        openPopIframePage(url);
    })

    ## 修改
    $(".btn_edit").click(function(){
        var bizId = $(this).parents('tr').attr('id'); // 取申请ID
        var pkey = $(this).parents('tr').attr('pkey');
        var url = "${rc.contextPath}/saleOrder/toUpdate?id="+bizId;
        openPopIframePage(url);
    })

##    ## 查看（示例：弹出Iframe窗口）
##    function openPopIframePage(url){
##        layer.open({
##            type: 2,
##            title: '确认',
##            shadeClose: true,
##            shade: false,
##            maxmin: true, //开启最大化最小化按钮
##            area: ['700px', '500px'],
##            content: url
##        });
##    }

    ## 办理（示例：弹出确认页）
    function openPopDivPage_taskAudit(){
        layer.open({
            type: 1,
            title: false, //不显示标题
            skin: 'layui-layer-rim', //加上边框
            area: ['600px', '240px'], //宽高
//            closeBtn: 0, //不显示关闭按钮
            shadeClose: true, //开启遮罩关闭
            content: $('.task-audit'),
        });
    }


    ## 办理-申请调整（示例：弹出确认页）
    function openPopDivPage_taskModify(){
        var url = "/workflow/task/toReApply";
        $.ajax({
            url:url,
            type:"post",
            data:{
                "taskId":taskId
            },
            success: function(returnData){
                $(".task-modify").html(returnData);
            }
        });
        layer.open({
            type: 1,
            title: false, //不显示标题
            skin: 'layui-layer-rim', //加上边框
            area: ['600px', '240px'], //宽高
//            closeBtn: 0, //不显示关闭按钮
            shadeClose: true, //开启遮罩关闭
            content: $('.task-modify'),
        });
    }

    ## 同意
    $(".agree-apply").click(function(){
        complete(true);
    })

    ## 驳回
    $(".reject-apply").click(function(){
        if ($.trim($('#reason').val()) == '') {
            layer.msg('请填写驳回原因');
            return;
        }

        complete(false);
    })


    ## 重新申请
    $(".task-modify").on("click", ".re-apply", function(){

        layer.confirm('请确定您已经调整过申请了', {
            title: '重新申请',
            btn: ['确认','取消'] //按钮
        }, function(){
            complete(true);
        }, function(){
        });

    })
    ## 终止申请
    $(".task-modify").on("click", ".channel-apply", function(){

        layer.confirm('此申请即将终止，如需申请请再次提交申请单', {
            title: '取消申请',
            btn: ['确认','取消'] //按钮
        }, function(){
            complete(false);
        }, function(){
        });
    })


    // 办理
    function complete(result){
        var url = '/workflow/task/complete.json';
        $.ajax({
            url:url,
            type:"post",
            data:{
                "pkey":pkey,
                "tkey":tkey,
                "pid":pid,
                "bizId":bizId,
                "taskId":taskId,
                "result":result,
                "reason":$.trim($('#reason').val())
            },
            success: function(returnData){
                if(returnData.code == 1){
                    layer.msg('审批完成');

                    setTimeout(function(){
                        window.location.href = "${rc.contextPath}/workflow/task/todo";
                        }, 300
                    );
                } else{
                    layer.msg('操作失败, 请联系技术人员!');
                }
            }
        });
    }



    /**
     * 验证文件格式以及文件大小
     */
    uploader.on("error",function (type){
        if (type=="Q_TYPE_DENIED"){
            layer.msg('请上传gif,jpg,jpeg,bmp,png格式文件');
        }else if(type=="F_EXCEED_SIZE"){
            layer.msg("文件大小不能超过"+file_maxSize + "M");
        }
    });


    ## 上传扫描版合同(首次)
    $(".button_contract_img").click(function(){
        var bizId = $(this).parents('td').attr('tid'); // 取申请ID
        uploadContractFile(bizId, "first");
    })
    ## 上传扫描版合同(续传)
    $(".button_contract_img_continue").click(function(){
        var bizId = $(this).parents('td').attr('tid'); // 取申请ID
        layer.confirm('续传将保留已上传图片，<label class="text-danger">继续增加图片</label>。是否保留已上传图片？', {
            title: '确认',
            btn: ['确认','取消'] //按钮
        }, function(){
            layer.closeAll('dialog');
            uploadContractFile(bizId, "continue");
        }, function(){
        });
    })
    ## 上传扫描版合同(重传)
    $(".button_contract_img_reupload").click(function(){
        var bizId = $(this).parents('td').attr('tid'); // 取申请ID
        layer.confirm('重传将删除已上传图片，<label class="text-danger">重新上传图片</label>。是否删除已上传图片？', {
            title: '确认',
            btn: ['确认','取消'] //按钮
        }, function(){
            layer.closeAll('dialog');
            uploadContractFile(bizId, "reupload");
        }, function(){
        });
    })
    function uploadContractFile(bizId, uploadType) {
        uploadFile(bizId, 1, uploadType);
    }



    ## 上传扫描版排期(首次)
    $(".button_execute_order_img").click(function(){
        var bizId = $(this).parents('td').attr('tid'); // 取申请ID
        uploadExecuteFile(bizId, "first");
    })
    ## 上传扫描版排期(续传)
    $(".button_execute_img_continue").click(function(){
        var bizId = $(this).parents('td').attr('tid'); // 取申请ID
        layer.confirm('续传将保留已上传图片，<label class="text-danger">继续增加图片</label>。是否保留已上传图片？', {
            title: '确认',
            btn: ['确认','取消'] //按钮
        }, function(){
            layer.closeAll('dialog');
            uploadExecuteFile(bizId, "continue");
        }, function(){
        });
    })
    ## 上传扫描版排期(重传)
    $(".button_execute_img_reupload").click(function(){
        var bizId = $(this).parents('td').attr('tid'); // 取申请ID
        layer.confirm('重传将删除已上传图片，<label class="text-danger">重新上传图片</label>。是否删除已上传图片？', {
            title: '确认',
            btn: ['确认','取消'] //按钮
        }, function(){
            layer.closeAll('dialog');
            uploadExecuteFile(bizId, "reupload");
        }, function(){
        });
    })
    function uploadExecuteFile(bizId, uploadType) {
        uploadFile(bizId, 2, uploadType);
    }


    function uploadFile(bizId, picType, uploadType) {
        // WebUploader初始化以后添加自定义参数
        uploader.options.formData.bizId = bizId;
        uploader.options.formData.picType = picType;
        uploader.options.formData.uploadType = uploadType;
        layer.open({
            type: 1,
            title: false, //不显示标题
            skin: 'layui-layer-rim', //加上边框
            area: ['600px', '400px'], //宽高
//            closeBtn: 0, //不显示关闭按钮
            shadeClose: true, //开启遮罩关闭
            content: $('.file-upload'),
        });
        uploader.refresh();
    }

    ## 预览已上传图片（合同）
    $(".button_view_contract_img").click(function(){
        var tid = $(this).parents('td').attr('tid'); // 取申请ID
        var bizName = $(this).parents('td').attr('tname'); // 项目编号
        var url = "${rc.contextPath}/saleOrder/preViewImg?bizType=1&bizName="+bizName+"&bizId="+tid;
        openPopIframePage(url);
    })

    ## 预览已上传图片（排期单）
    $(".button_view_execute_img").click(function(){
        var tid = $(this).parents('td').attr('tid'); // 取申请ID
        var bizName = $(this).parents('td').attr('tname'); // 项目编号
        var url = "${rc.contextPath}/saleOrder/preViewImg?bizType=2&bizName="+bizName+"&bizId="+tid;
        openPopIframePage(url);
    })



    ## 查看应收催款单
    $(".button_view_reminder_payment").click(function(){
        var tid = $(this).parents('td').attr('tid'); // 取申请ID
        var bizName = $(this).parents('td').attr('tname'); // 项目编号
        var url = "${rc.contextPath}/saleOrder/reminderPaymentList?bizId=" + tid;
        openPopIframePage(url);
    })


    ## 查看成本确认单
    $(".button_view_confirm_cost").click(function(){
        var tid = $(this).parents('td').attr('tid'); // 取申请ID
        var bizName = $(this).parents('td').attr('tname'); // 项目编号
        var url = "${rc.contextPath}/report/finalReport/?likeSearch=" + bizName;
        openPopIframePage(url);
    })



</script>
#end