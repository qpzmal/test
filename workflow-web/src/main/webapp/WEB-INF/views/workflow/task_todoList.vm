

<div class="wrapper wrapper-content">
##    <button type="button" class="btn btn-w-m btn-primary"><i class="fa fa-plus "></i> 添加</button>
    #foreach($mapKey in ${resultMap.keySet()})
    #set($mapValue = ${resultMap.get($mapKey)})
        <div class="row">
            <div class="col-sm-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        #foreach($!{data} in $!{mapValue})
                            ## 第2行时跳出循环（示例：跳出循环）
                            #if($!{velocityCount} == 2) #break #end
                            <h5>$!{data.processInstance.processDefinitionName}</h5>
                        #end
                    </div>
                    <div class="ibox-content">
                        <table class="table table-bordered table-striped">
                            <thead>
                            <tr>
                                <th>审批流程名称</th>
                                <th>申请人</th>
                                <th>申请时间</th>
                                <th>开始时间</th>
                                <th>结束时间</th>
                                <th>当前节点</th>
                                <th>任务创建时间</th>
                                <th>流程状态</th>
                                <th>操作</th>
                            </tr>
                            </thead>
                            <tbody>
                                #foreach($!{data} in $!{mapValue})
                                <tr id="$!{data.baseBuyOrder.id}" tid="$!{data.task.id}">
                                    <td>$!{data.baseBuyOrder.name}</td>
                                    <td>$!{data.baseBuyOrder.userId}</td>
                                    <td>$!{data.baseBuyOrder.applyTime}</td>
                                    <td>$!{data.baseBuyOrder.startTime}</td>
                                    <td>$!{data.baseBuyOrder.endTime}</td>
                                    <td>
                                        <a class="trace" href='#' pid="$!{data.processInstance.id}" pdid="${data.processInstance.processDefinitionId}" title="点击查看流程图">$!{data.task.name}</a>
                                    </td>
                                ##                                <td><a target="_blank" href='${ctx}/workflow/resource/process-instance?pid=${data.processInstance.id}&type=xml'>${data.task.name}</a></td>
                                    <td>$!{data.task.createTime}</td>
                                    <td>
                                    ##                                    ${pi.suspended ? "已挂起" : "正常" }；
                                        <b title='流程版本号'>V: $!{data.processDefinition.version}</b>
                                    </td>
                                    <td>
                                        #if(!${data.task.assignee})
                                            <a class="claim btn_claim" href="javascript:;">签收</a>
                                        #end
                                        #if(${data.task.assignee})
                                        ##                                        此处用tkey记录当前节点的名称
                                            <a class="handle btn_handle" tkey='$!{data.task.taskDefinitionKey}' tname='$!{data.task.name}' href="javascript:;">办理</a>
                                        #end
                                    </td>
                                </tr>
                                #end
                            </tbody>
                        </table>

                    </div>
                </div>
            </div>
        </div>
    #end
</div>



#define($jsblock)
<script>
    $(function(){

    });

    ## 签收（示例：弹出确认框）
    $(".btn_claim").click(function(){
        var taskId = $(this).parents('tr').attr('tid');

        layer.confirm('确认签收？', {
            title: '确认',
            btn: ['确认','取消'] //按钮
        }, function(){
            window.location.href = "/workflow/task/claim/" + taskId;
        }, function(){
        });
    })

    ## 办理
    $(".btn_handle").click(function(){
        var taskId = $(this).parents('tr').attr('tid');
        openPopPage(taskId);
    })


    ## 签收（示例：弹出确认页）
    function openPopPage(taskId){
        layer.open({
            type: 2,
            title: '确认',
            shadeClose: true,
            shade: false,
            maxmin: true, //开启最大化最小化按钮
            area: ['893px', '600px'],
            content: '/workflow/task/audit'
        });
//        doHandle(taskId);
    }

    function doHandle(taskId) {
        var mediaGMPass = true;
        window.location.href = "/workflow/task/complete?taskId="+taskId+ "&mediaGMPass=true";
    }
</script>
#end