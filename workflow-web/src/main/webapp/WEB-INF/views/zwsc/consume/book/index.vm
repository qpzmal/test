<div class="top">
	<label class="top-l">消费数据：</label>
	<div class="top-r">
		<label class="content-lab">*选择时间：</label>
           <input type="text" id="startTime" name="startTime" class="datepicker">&nbsp;&nbsp;——&nbsp;&nbsp;
           <input type="text" id="endTime" name="endTime" class="datepicker">
           <input type="button" value="  确  定  " class="inp-sure" onclick="drawAmtChart();">
	</div>
	<div class="bottom">
		<span>购买图书总金额: <b><span id="moneyData">0</span></b>铜币&nbsp;
		     <b><span id="cashData">0</span></b>铜币代金卷&nbsp;&nbsp;&nbsp;&nbsp;
		             购买次数：<b><span id="pvData">0</span></b>&nbsp;&nbsp;&nbsp;&nbsp;
		             购买用户数：<b><span id="uvData">0</span></b></span>
	</div>
</div>
<!--下拉框-->
<div class="timer" style="margin-bottom:10px;">
	<label>时间周期：</label>
       <select id="timeCycleSel" name="timeCycle">
           <option value="1">日</option>
           <option value="2">周</option>
           <option value="3">月</option>
       </select>   
</div>
<div id="tabs">
    <ul>
           <li><a href="#zbamt">消费额度图</a></li>
           <li><a href="#zbtype">购买类型</a></li>
       </ul>
	<!--统计图-->
	<div id="zbamt" style="margin-top:10px">
        <div class="money-con mt-list">
            <input type="button" value="导出" class="money-btn" onclick="exportTrend();">
        </div>
		<div class="pic" id="chartDiv" style="width: 600px;height:400px;margin-left:auto;margin-right:auto">
		</div>
	</div>
	<div id="zbtype">
	    #parse('zwsc/consume/book/type.vm')
	</div>
</div>	
<script src="${rc.contextPath}/static/js/jquery-ui.tab.js"></script>
<link href="${rc.contextPath}/static/css/jquery-ui.tab.css" rel="stylesheet">
<script>
    $(function(){
        //设置产品选项
        $("#productSel").html("<option value='1'>中文书城</option>");
        jsUtil.setHeaderInfo("${rc.contextPath}");
        
    	$("#tabs").tabs({
    		activate: function(event, ui){
    			if(ui.newPanel.selector == "#zbtype"){
    				drawTypePage();
    			}
    		}
    	});
    	drawAmtChart();
    });
    
    //绘制echarts图表并展示头部总览数据
    function drawAmtChart(){
        drawTypePage();
        var params = {
            timeCycle: $("#timeCycleSel").val(),
            startTime: $("#startTime").val(),
            endTime: $("#endTime").val(),
            version: $("#versionSel").val(),
            cnids: $("#cnids").val()
        };
    	$.ajax({
    		url: "${rc.contextPath}/zwsc/consume/book/getAmtChart.json",
    		type: "POST",
    		data: params,
    		success: function(returnData){
    			if(returnData.code == 1){
    				var myChart = echarts.init(document.getElementById("chartDiv"));
                    myChart.setOption(returnData.data.chart);
                    $("#moneyData").text(returnData.data.summary.totalMoney);
                    $("#cashData").text(returnData.data.summary.totalCash);
                    $("#pvData").text(returnData.data.summary.totalPV);
                    $("#uvData").text(returnData.data.summary.totalUV);
    			} else{
    				alert(returnData.info);
    				//window.location.reload();
    			}
    		}
    	});
    }

    function exportTrend(){
        var startTime = $("#startTime").val();
        var timeCycle = $("#timeCycleSel").val();
        var endTime = $("#endTime").val();
        var version = $("#versionSel").val();
        var cnids = $("#cnids").val();
        window.location.href="/zwsc/consume/book/exportChart.json?startTime="+startTime+"" +
                "&endTime="+endTime+"&version="+version+"&cnids="+cnids+"&timeCycle="+timeCycle+"";
    }
</script>