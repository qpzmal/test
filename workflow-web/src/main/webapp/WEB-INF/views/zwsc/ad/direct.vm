<div class="money-con mt-list">
    <h3>直投类广告数据：</h3>
    广告名称：<select id="earnName"></select>
    <input type="button" value="  查  询  " class="inp-sure" onclick="directQuery();">
    <input type="button" value="导出" class="money-btn" onclick="exportInstallData();">
</div>
<table class="money-data mt-10 mb-30">
    <thead>
    <tr>
        <th width="150">编号</th>
        <th width="150">日期</th>
        <th width="150">广告名称</th>
        <th width="150">曝光PV</th>
        <th width="100">曝光UV</th>
        <th width="150">点击PV</th>
        <th width="100">点击UV</th>
        <th width="150">安装成功PV</th>
        <th width="100">安装成功UV</th>
    </tr>
    </thead>
    <tbody id="tableData">
    </tbody>
</table>
<div class="tcdPageCode"></div>
<link rel="stylesheet" href="${rc.contextPath}/static/css/page.css">
<script src="${rc.contextPath}/static/js/jquery.page.js"></script>
<script>

    function drawInstallData(){
        var params = {
            startTime: $("#startTime").val(),
            endTime: $("#endTime").val(),
            cnids: $("#cnids").val(),
            earnName: $("#earnName").val()
        };
    	setInstallDataPageData(1);
    	createInstallPageWidget(params);

        $.ajax({
            url: "${rc.contextPath}/zwsc/ad/getEarnName.json",
            type: "POST",
            success: function(returnData){
                if(returnData.code == 1){
                    var data = returnData.data;
                    $("#earnName").html("");
                    $("#earnName").append(" <option value=''>----请选择----</option>");
                    for(var i in data){
                        $("#earnName").append("<option value="+data[i].earnName+">"+data[i].earnName+"</option>");
                    }
                } else{
                    alert(returnData.info);
                    return;
                }
            }
        });
    }

    function directQuery(){
        var params = {
            startTime: $("#startTime").val(),
            endTime: $("#endTime").val(),
            cnids: $("#cnids").val(),
            earnName: $("#earnName").val()
        };
        setInstallDataPageData(1);
        createInstallPageWidget(params);
    }

    function createInstallPageWidget(params){
        var totalPage = 0;
    	$.ajax({
            url: "${rc.contextPath}/zwsc/ad/getInstallDataPageCnt.json",
            type: "POST",
            data: params,
            success: function(returnData){
                if(returnData.code == 1){
                    totalPage = returnData.data;
                    //创建分页插件
                    $(".tcdPageCode").createPage({
                        pageCount: totalPage,
                        current:1,
                        backFn: function(p){//p为当前页号
                            setInstallDataPageData(p);
                        }
                    });
                } else{
                    alert(returnData.info);
                    return;
                }
            }
    	});
    }
    
    function setInstallDataPageData(pageNo){
        var params = {
            startTime: $("#startTime").val(),
            endTime: $("#endTime").val(),
            cnids: $("#cnids").val(),
            earnName: $("#earnName").val(),
            pageNo:pageNo//添加页号信息
        };
       $.ajax({
           url: "${rc.contextPath}/zwsc/ad/getInstallDataByPage.json",
           type: "POST",
           data: params,
           success: function(returnData){
               if(returnData.code == 1){
                   var tableData = "";
                   $("#tableData").html(tableData);
                   var count = 1;
                   var flag = returnData.data[0].dt;
                   $.each(returnData.data, function(i, item){
                       //要求一个日期一组序号
                       if(item.dt != flag){
                           flag = item.dt;
                           count = 1;
                       }
                       tableData += "<tr><td>"
                           + (count++) + "</td><td>"
                           + item.dt + "</td><td>"
                           + item.earnname + "</td><td>"
                           + item.bgPVs + "</td><td>"
                           + item.bgUVs + "</td><td>"
                           + item.djPVs + "</td><td>"
                           + item.djUVs + "</td><td>"
                           + item.azPVs + "</td><td>"
                           + item.azUVs + "</td></tr>";
                   });
                   $("#tableData").html(tableData);
               }
           }
       });      
    }
    
    function exportInstallData(){
        var startTime = $("#startTime").val();
        var endTime = $("#endTime").val();
        var cnids = $("#cnids").val();
        var earnName = $("#earnName").val();
        window.location.href="/zwsc/ad/exportInstallData.json?startTime="+startTime+"" +
                "&endTime="+endTime+"&cnids="+cnids+"&earnName="+earnName+"";
     }
</script>