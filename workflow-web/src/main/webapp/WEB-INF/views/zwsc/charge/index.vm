<div class="top">
	<label class="top-l">充值数据：</label>
	<div class="top-r">
		<label class="content-lab">*选择时间：</label>
		<input type="text" id="startTime" name="startTime" class="datepicker">&nbsp;&nbsp;——&nbsp;&nbsp;
		<input type="text" id="endTime" name="endTime" class="datepicker">
		<input type="button" value="  确  定  " class="inp-sure" onclick="refreshData();">
	</div>
	<div class="bottom">
		<span>充值总金额:<b><span id="moneySum">0</span></b>&nbsp;&nbsp;&nbsp;&nbsp;
		充值次数：<b><span id="timeSum">0</span></b>&nbsp;&nbsp;&nbsp;&nbsp;
		充值用户数：<b><span id="userSum">0</span></b></span>
	</div>
</div>
<!--下拉框-->
<div class="timer" style="margin-bottom:10px;">
	<label>时间周期：</label>
	<select id="timeCycleSel" name="timeCycle">
		<option value="1">日</option>
		<option value="2">周</option>
		<option value="3">月</option>
	</select>		
</div>
		
<div id="tabs">
    <ul>
        <li><a href="#ctrend">充值趋势图</a></li>
        <li><a href="#cway">充值方式统计</a></li>
        <li><a href="#cgive">充值赠送铜币额度</a></li>
    </ul>

	<!--统计图-->
	<div id="ctrend">
	    <div class="money-con mt-list">    
               <input type="button" value="导出" class="money-btn" onclick="exportTrend();">
           </div>
		<div class="pic" id="chartDiv" style="width: 600px;height:400px;margin-left:auto;margin-right:auto">
		</div>
	</div>
	
	<div id="cway">
	  #parse('zwsc/charge/index_way.vm')
	</div>
	<div id="cgive">
	  #parse('zwsc/charge/index_give.vm')
	</div>
</div>
<script src="${rc.contextPath}/static/js/jquery-ui.tab.js"></script>
<link href="${rc.contextPath}/static/css/jquery-ui.tab.css" rel="stylesheet">
<script>
    $(function(){
    	//设置产品选项
    	$("#productSel").html("<option value='1'>中文书城</option>");
    	jsUtil.setHeaderInfo("${rc.contextPath}");
    	//绘制默认图表
    	drawChart();
        $( "#tabs" ).tabs({
            activate: function(event, ui){
                if(ui.newPanel.selector == "#cway"){
                	drawWayPage();                 
                } else if(ui.newPanel.selector == "#cgive"){
                	drawGivePage();                 
                }
            }                        
        });
    });
    
    //重绘页面上的所有图表
    function refreshData(){
    	var params = {
    		startTime: $("#startTime").val(),
    		endTime: $("#endTime").val(),
    		version: $("#versionSel").val(),
    		cnids: $("#cnids").val()
    	};
    	drawChart(params);
    	drawWayPage();
    	drawGivePage();
    }
    
    //绘制图表并重新刷新头部信息
    function drawChart(params){
    	if(params === undefined){
    		params = {
    	            timeCycle: $("#timeCycleSel").val(),
    	            startTime: $("#startTime").val(),
    	            endTime: $("#endTime").val(),
    	            version: $("#versionSel").val(),
    	            cnids: $("#cnids").val()
    	        };
    	} else{
    		params["timeCycle"] = $("#timeCycleSel").val();
    	}
    	$.ajax({
    		url: "${rc.contextPath}/zwsc/charge/getTrendChart.json",
    		type: "POST",
    		data: params,
    		success: function(returnData){
    			if(returnData.code == 1){
    				$("#moneySum").text(returnData.data.summary.moneySum);    				
    				$("#timeSum").text(returnData.data.summary.timeSum);    				
    				$("#userSum").text(returnData.data.summary.userSum);    				
    				
    				var myChart = echarts.init(document.getElementById("chartDiv"));
    				myChart.setOption(returnData.data.chart);
    			} else{
    				alert(returnData.info);
    				window.location.reload();
    			}
    		}
    	});
    }
    
    function exportTrend(){
        var startTime = $("#startTime").val();
        var timeCycle = $("#timeCycleSel").val();
        var endTime = $("#endTime").val();
        var version = $("#versionSel").val();
        var cnids = $("#cnids").val();
        window.location.href="/zwsc/charge/exportTrend.json?startTime="+startTime+"" +
                "&endTime="+endTime+"&version="+version+"&cnids="+cnids+"&timeCycle="+timeCycle+"";
    }
</script>