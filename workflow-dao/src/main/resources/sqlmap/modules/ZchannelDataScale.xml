<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.advu.workflow.dao.database.ZChannelDataScaleMapper">


    <select id="getChannelDataScales" resultType="cn.advu.workflow.domain.database.ChannelDataScale">
        SELECT * FROM channel_data_scale WHERE 1=1
            <if test="cnid !=null and cnid !=''"  >
              AND cnid=#{cnid}
            </if>
            <if test="scaleType !=null and scaleType !=''"  >
              AND scaleType=#{scaleType}
            </if>
            <if test="channel !=null and channel !=''"  >
                AND cnid in (${channel})
            </if>
        ORDER BY createTime DESC
        limit  #{start, jdbcType=INTEGER},#{pageSize, jdbcType=INTEGER}
    </select>

    <select id="getChannelDataScalesCount" resultType="java.lang.Integer">
        SELECT count(id) FROM channel_data_scale WHERE 1=1
        <if test="cnid !=null and cnid !=''"  >
          AND cnid=#{cnid}
        </if>
        <if test="scaleType !=null and scaleType !=''"  >
          AND scaleType=#{scaleType}
        </if>
        <if test="channel !=null and channel !=''"  >
            AND cnid in (${channel})
        </if>
    </select>
    <insert id="addChannelDataScale" parameterType="cn.advu.workflow.domain.database.ChannelDataScale">
        insert into channel_data_scale
        (cnid,startTime,endTime,newUserScale,activeUserScale,incomeScale,updateUser,createTime,scaleType)
         VALUES
        (#{channelDataScale.cnid},
        #{channelDataScale.startTime},
        #{channelDataScale.endTime},
        #{channelDataScale.newUserScale},
        #{channelDataScale.activeUserScale},
        #{channelDataScale.incomeScale},
        #{channelDataScale.updateUser},
        now(),
        #{channelDataScale.scaleType})
    </insert>

    <update id="updateChannelScale">
        update channel_data_scale
         <set>
             <if test="cnid!=null and cnid!=''">
             cnid=#{cnid},
             </if>

             startTime=#{startTime},

             endTime=#{endTime},
             <if test="newUserScale!=null and newUserScale!=''">
             newUserScale=#{newUserScale},
             </if>
              <if test="activeUserScale!=null and activeUserScale!=''">
             newUserScale=#{activeUserScale},
              </if>
             <if test="incomeScale!=null and incomeScale!=''">
             incomeScale=#{incomeScale},
             </if>
             <if test="updateUser!=null and updateUser !=''">
             updateUser=#{updateUser}
             </if>
         </set>

        WHERE id=#{id}
    </update>
    <delete id="deleteChannelDataById">
        delete from channel_data_scale where id=#{id}
    </delete>

    <select id="getChannelDataScalesById" resultType="cn.advu.workflow.domain.database.ChannelDataScale">
        select id,startTime,endTime,newUserScale,activeUserScale,incomeScale,cnid,updateUser,createTime,updateTime
        FROM
        channel_data_scale
        where id=#{id}
    </select>

    <select id="getChannelShareScale" resultType="cn.advu.workflow.domain.database.ChannelDataScale">
      select * from channel_data_scale
      where startTime <![CDATA[   <=  ]]> #{date}
      and  endTime <![CDATA[   >=  ]]> #{date1}
      and cnid= #{cnid}  limit 0,1;
    </select>

    <select id="findExchannelDataScale" resultType="cn.advu.workflow.domain.database.ChannelDataScale">
        <![CDATA[
        SELECT * FROM channel_data_scale WHERE cnid=#{cnid} AND ((startTime >=#{startTime} AND endTime>=#{endTime} ) OR (startTime >=#{startTime} AND startTime<=#{endTime} AND endTime >=#{endTime} ) OR (startTime <=#{startTime} AND endTime>=#{endTime} ) OR (startTime <=#{startTime} AND endTime>=#{startTime} AND endTime <= #{endTime} ) ) AND scaleType=#{scaleType} LIMIT 0,1;
     ]]>
    </select>
</mapper>
